<%= content_for :javascript do %>
	<%= javascript_include_tag  'jquery.uploadify' %> 
	<%= stylesheet_link_tag  'uploadify' %> 
<% end %>
<!-- Pricing Option -->
<div id="in_pricing">
	<div class="container">
		<div class="section_header">
			&nbsp;
		</div>

		<div class="row charts_wrapp">
			<!-- Plan Box -->
			<div class="col-sm-12">
				<div class="plan">
					<div class="wrapper">

						<div class="row">
							<div class="page-header">
								<h2>Design Center</h2>
							</div>
						</div>
						<div class="row">
							<div class="page-header">
								<h3>Creating your lookbook</h3>
							</div>
						</div>
						<%= form_tag designer_lookbook_contest_path(params[:id]),  {:id => "lookbook", :method => "post"} do %>
						
						<input type="hidden" name="lookbook_photo[document]" id="lookbook_image" value="<%= session[:step4][:document] if session[:step4].present? %>">
						<input type="hidden" name="lookbook_photo[document_id]" id="look_image_id" value="<%= session[:step4][:document_id] if session[:step4].present? %>">
						
						<div class="container col-sm-offset-1 preview">

							<div class="row">
								<h4 style="padding-left:15px;">What do you want to include in your design?</h4>
							</div>
							<div class="row">
								<div class="col-sm-8 form-inline" >
									<label style="float:left;">Add picture</label>
									<div class="col-sm-6">
										<input name="" type="file" id="file_input">
										<span>(.jpg, .tif, .png)</span>
									</div>
								</div>
							</div>

							<div class="row img_container" id="image_display">
							</div>
							
							<div class="row">
								<div class="page-header" style="width:65%">
								</div>
							</div>
							
							<div class="row lnk_container">
								<div class="col-sm-8 link_box">
									<label>Add Links</label>
									<input name="lookbook_link[links][]" type="text" class="link_url" class="form-control">
									<a class="plus_wrapper" href="#"> <span>&#43;</span> </a>
									<a class="minus_wrapper" href="#"> <span>&#45;</span> </a>
								</div>
								<div class="col-sm-8 lnk_tit_box">

									<label>Add text to go at bottom of image</label>
									<input name="lookbook_link[link_title][]" type="text" class="form-control">

								</div>
								
							</div>

							<div class="row">
								<div class="col-sm-8">
									<label>Tell your client more about your design</label>
									<textarea name="" row="50" style="width:90%" column="20" class="form-control"> 
										</textarea>
								</div>
							</div>

						</div>

						<div class="row">
							<center>
								<div class="col-sm-4 col-sm-offset-4">
									<a class="order continue" href="#" style="width:68%">Preview And Save</a>
								</div>
							</center>
						</div> 
						<% end %>

					</div>

				</div>
			</div>
		</div>

	</div>

</div>


<script type="text/javascript">

  jQuery(".continue").click(function(e){
		e.preventDefault();
		jQuery(".text-error").html("");
		
		var bool = false;
		var can_submit = false;
		
		jQuery(".link_url").each(function(){
			var url_value= jQuery.trim(jQuery(this).val());
			if(url_value.length > 1) {
				var rege = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
				if(!rege.test(url_value))	{
					bool = true;	
			   } else {
					can_submit = true	   	
			   }
			}
		}) 
		
		if(bool) {
		   alert("Please enter valid Link URL.")
		   return false;
		} else {
			if(can_submit) {
				jQuery("#lookbook").submit();
				return true;
			} else {
				if(jQuery.trim(jQuery("#look_image_id").val()).length > 1) {
					jQuery("#lookbook").submit();
					return true;
				} else {
					alert("Please add atleast one picture or Link.")
					return false;
				}
			}		
		}
  });	

  jQuery(function() {  
    // encode the session into a Flash-save format
   <% session_key = Rails.application.config.session_options[:key] %>
   
    jQuery('#file_input').uploadify ({
      uploader        : '<%= documents_path %>',
      swf    : '/uploadify.swf',
      buttonText : 'Upload',
      fileSizeLimit   : <%=  1.megabytes %>,
      fileTypeExts:  '*.png;*.jpg;*.tif',
      uploadLimit     : 3, 
      fileObjName : 'photo',
      multi           : false,
      auto            : true,
      removeTimeout :10,
      onUploadSuccess : function(file, data, response) {
      						var info = data.split(',');
      						
									
								
jQuery("#image_display").append("<div class='col-sm-8 img_img_box' style='padding-top:20px;'><div class='img' style='width:50%;float:left'><img src='" + info[0] + "' /></div><label style='float:left'>Add text to go at bottom of image</br><input name='lookbook_photo[photo_title][]' type='text' style='width:100%'></label></div>");
      						var img_val = $.trim($("#lookbook_image").val());
      						var img_id = $.trim($("#look_image_id").val());
      						alert(info[1]);
      						if(img_val.length < 1) {
      							$("#lookbook_image").val(info[0]);
      							$("#look_image_id").val(info[1]);
      						} else {
      							$("#lookbook_image").val(img_val + ','+info[0]);
      							$("#look_image_id").val(img_id + ','+info[1]);
      						}
      					},  
      formData : {"<%= key = Rails.application.config.session_options[:key] %>" :"<%= cookies[key] %>",
        "<%= request_forgery_protection_token %>" : "<%= form_authenticity_token %>"},
      cancelImg       : '/images/cancel.png'  //take care that the image is accessible
    });
  });
</script>

<script type="text/javascript">
	$(document).on("click", ".img_container .plus_wrapper", function() {
		var $rows = $('.img_container:first').first();
		$formclone = $rows.clone()
		$formclone.find('input').val('');
		$formclone.find('.img_img_box').hide();
		$formclone.insertAfter($('.img_container:last'));
		$(".img_container .plus_wrapper").hide();
		if ($(".img_container .plus_wrapper").length > 1) {
			$(".img_container .minus_wrapper").show();
		}
		$(".img_container .plus_wrapper:last").last().show();
		//$('.particiapntForm:last').find('.frmdestroyer').show();
	});
	$(document).on("click", ".img_container .minus_wrapper", function() {
		$(this).parent().parent().remove();
		if ($(".img_container .plus_wrapper").length == 1) {
			$(".img_container .minus_wrapper").hide();
		}
		$(".img_container .plus_wrapper:last").last().show();
	});

	$(document).on("click", ".lnk_container .plus_wrapper", function() {
		var $rows = $('.lnk_container:first').first();
		$formclone = $rows.clone()
		$formclone.find('input').val('');
		$formclone.find('.lnk_img_box').hide();
		$formclone.insertAfter($('.lnk_container:last'));
		$(".lnk_container .plus_wrapper").hide();
		if ($(".lnk_container .plus_wrapper").length > 1) {
			$(".lnk_container .minus_wrapper").show();
		}
		$(".lnk_container .plus_wrapper:last").last().show();
		//$('.particiapntForm:last').find('.frmdestroyer').show();
	});
	$(document).on("click", ".lnk_container .minus_wrapper", function() {
		$(this).parent().parent().remove();
		if ($(".lnk_container .plus_wrapper").length == 1) {
			$(".lnk_container .minus_wrapper").hide();
		}
		$(".lnk_container .plus_wrapper:last").last().show();
	});

</script>